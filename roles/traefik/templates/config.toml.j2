################################################################
#
# Dynamic Configuration for Traefik v2
# https://doc.traefik.io/traefik/reference/dynamic-configuration/file/
#
################################################################

[http]
  [http.routers.{{ service.name }}]
  rule = "Host(`{{ service.host }}`)"
  service = "{{ service.name }}"
    [http.routers.{{ service.name }}.tls]
    certResolver = "lets-encrypt"
  [http.services.{{ service.name }}.loadBalancer]
{% for target in service.targets %}
    [[http.services.{{ service.name }}.loadBalancer.servers]]
    url = "{{ target }}"
{% endfor %}

  [http.routers.internal-api]
  rule = "Host(`{{ dashboard.host }}`)"
  service = "api@internal"
  middlewares = ["internal-auth"]
    [http.routers.internal-api.tls]
    certResolver = "lets-encrypt"

  [http.middlewares.internal-auth.basicAuth]
  users = {{ dashboard.authorized_users }}
